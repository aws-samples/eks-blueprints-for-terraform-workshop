---
title: "Applicationset and Generator"
weight: 20
---

In the upcoming chapters, we will use labels (key/value pairs) to deploy workloads, namespaces, and addons to clusters using Argo CD. For example, setting `workload_webstore = true` and `environment = staging` will have Argo CD deploy a staging version of the webstore workload and associated namespace (including namespace, limitrange, quota, etc) on a cluster with these labels. Setting `enable_aws_load_balancer_controller = true` will have Argo CD install the AWS Load Balancer controller on a cluster that has this label.

All of these workloads, namespaces, and addons are deployed by Argo CD Applications. An Application points to a Git source repository (namespace, workload, addon) and the destination cluster. The Applications are dynamically generated by ApplicationSet based on the values of the labels.

Manually creating addons for each cluster would not scale well in an enterprise setting with many addons and clusters.

![applicationset](/static/images/multicluster-addons.png)

ApplicationSet is an effective way to generate and manage a set of Applications across multiple clusters and environments.
Think of ApplicationSet as a factory for Applications.

![applicationset](/static/images/applicationset.png)

ApplicationSet utilizes different types of [Generator](https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Generators/) like cluster, git, matrix etc to generate Applications.

Let's examine how the Cluster generator creates Applications. A cluster generator works with Cluster objects. We have already seen the "hub-cluster" object in the "Install Argo CD" chapter.

![EKS Cluster](/static/images/argocd-cluster-object.png)

Let's say there are 3 cluster objects - hub-cluster, spoke-staging and spoke-prod with different labels (key value pairs).

The following is a code snippet of an ApplicationSet. The cluster generator creates one application because one cluster label matches the criteria.

```
  .
  .
  generators:
  - clusters:
      selector:
        matchLabels:
          environment: hub
  .
  .
```

![applicationset](/static/images/applicationset-controlplane.png)

The following generator creates 2 applications because 2 cluster labels match the criteria.

```
  generators:
  - clusters:
      selector:
        matchLabels:
          workloads: true
```

![applicationset](/static/images/applicationset-workloads.png)

We can add additional labels to meet our criteria.

We can view how gitops-bridge populates the cluster secret that creates Argo CD cluster entries, and defines the labels and annotations that can be used by the ApplicationSets:

```bash
kubectl --context hub-cluster get secrets -n argocd hub-cluster -o yaml
```

:::expand{header="Example of output"}

```
apiVersion: v1
data:
  config: ewogICJ0bHNDbGllbnRDb25maWciOiB7CiAgICAiaW5zZWN1cmUiOiBmYWxzZQogIH0KfQo=
  name: aHViLWNsdXN0ZXI=
  server: aHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3Zj
kind: Secret
metadata:
  annotations:
    cluster_name: hub-cluster
    environment: control-plane
  creationTimestamp: "2024-10-03T18:51:28Z"
  labels:
    argocd.argoproj.io/secret-type: cluster
    cluster_name: hub-cluster
    enable_argocd: "true"
    environment: control-plane
  name: hub-cluster
  namespace: argocd
  resourceVersion: "6498"
  uid: ad023c6c-1a97-45c7-92b6-33a3f17021b7
type: Opaque
```

:::
